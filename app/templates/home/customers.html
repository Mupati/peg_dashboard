{% extends "partials/layout.html" %} {% block content %}
<!-- DataTables Example -->
<div class="card mb-3">
  <div class="card-header">
    <span>
      <i class="fas fa-table"></i>
      Customers Table
    </span>
    <div class="float-right">
      <button
        data-toggle="modal"
        data-target="#customerModal"
        class="btn btn-primary"
      >
        Add Customer
      </button>
    </div>
  </div>

  <div class="card-body">
    <div class="table-responsive">
      <table
        class="table table-bordered"
        id="dataTable"
        width="100%"
        cellspacing="0"
      >
        <thead>
          <tr>
            <th>Customer ID</th>
            <th>First Name</th>
            <th>Last Name</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <th>Customer ID</th>
            <th>First Name</th>
            <th>Last Name</th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  <div class="card-footer small text-muted">
    Updated yesterday at 11:59 PM
  </div>
</div>
{% endblock %} {% block modals%}

<!-- Customer Addition Modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="customerModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Customer</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="/customers" method="POST">
          <div class="form-group">
            <label for="formGroupExampleInput">{{
              form.first_name.label
            }}</label>
            {{form.first_name(class_="form-control")}}
          </div>
          <div class="form-group">
            <label for="formGroupExampleInput2">{{
              form.last_name.label
            }}</label>
            {{form.last_name(class_="form-control")}}
          </div>
          {{form.submit(class_="btn btn-primary btn-lg btn-block")}}
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Customer Editing or Deleting Modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="customerEditingModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update or Delete Customer</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="customerEditing" class="mx-auto">
          <input type="hidden" id="customerId" />
          <div class="form-group">
            {{ form.first_name.label }}
            <input type="text" class="form-control" id="firstName" name="first_name" />
          </div>
          <div class="form-group">
            {{ form.last_name.label }}
            <input type="text" class="form-control" id="lastName" name="last_name" />
          </div>
          <div class="text-right">
            <button id="updateCustomer" class="btn btn-success">Update</button>
            <button id="deleteCustomer" class="btn btn-danger">Delete</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- End of Customer Editing or Deleting Modal -->
{% endblock %} {% block scripts%}
<script>
  $(document).ready(function() {
    var table = $("#dataTable").DataTable({
      ajax: {
        url: "{{ url_for('home.fetch_customers_information')}}",
        dataType: "json",
        dataSrc: "data",
        contentType: "application/json"
      },
      columns: [{ data: "id" }, { data: "first_name" }, { data: "last_name" }]
    });

    $("#dataTable tbody").on("click", "tr", function() {
      var data = table.row(this).data();
      $("#customerId").val(data.id);
      $("#firstName").val(data.first_name);
      $("#lastName").val(data.last_name);
      $("#customerEditingModal").modal("show");
    });

    $("#updateCustomer").on("click", function() {
      alert($("#customerId").val());
    });

    $("#deleteCustomer").on("click", function(e) {
      e.preventDefault();
      var id = $("#customerId").val();
      console.log(id)
      $.ajax({
        type: "POST",
        url: "{{url_for('home.delete_customer')}}",
        data: JSON.stringify({ id }),
        dataType: "json"
      }).done(function(data) {
        console.log(data);
        $("#customerEditingModal").modal("hide");
      });
    });
  });
</script>
{% endblock %}
